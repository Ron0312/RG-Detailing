<IfModule mod_expires.c>
    ExpiresActive Off
</IfModule>

<IfModule mod_headers.c>
    # 1. Default: Force revalidation for everything (HTML, JSON, mutable images, sw.js)
    # This ensures that users always get the latest version of the site structure and mutable assets.
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</IfModule>

# 2. Identify Hashed Assets (Immutable)
# These are files in the _astro/ directory generated by Vite, which contain hashes in their filenames.
# We can safely cache these indefinitely.
SetEnvIf Request_URI "^/_astro/" IMMUTABLE_ASSET

<IfModule mod_headers.c>
    # 3. Apply aggressive caching ONLY to immutable assets
    # 1 year cache
    Header set Cache-Control "public, max-age=31536000, immutable" env=IMMUTABLE_ASSET

    # Remove the no-cache headers for these specific files
    Header unset Pragma env=IMMUTABLE_ASSET
    Header unset Expires env=IMMUTABLE_ASSET
</IfModule>

# Disable ETags to rely on our explicit Cache-Control headers
FileETag None
