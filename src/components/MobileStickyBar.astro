---
import { Phone, Calculator, MessageCircle } from 'lucide-react';
---
<div id="mobile-sticky-bar" inert aria-hidden="true" class="fixed bottom-0 left-0 right-0 z-[100] bg-zinc-950/95 backdrop-blur-xl border-t border-white/10 px-4 py-3 md:hidden flex justify-between items-center safe-area-bottom shadow-[0_-5px_20px_rgba(0,0,0,0.5)] translate-y-[150%] transition-transform duration-500">
    <a href="tel:+491633845081" onclick="window.trackEvent && window.trackEvent('contact_click', { channel: 'phone', location: 'mobile_bar' })" class="flex flex-col items-center gap-1 text-zinc-400 hover:text-white transition-colors active:scale-95 w-16">
        <Phone size={22} strokeWidth={1.5} />
        <span class="text-[9px] font-bold uppercase tracking-wider">Anrufen</span>
    </a>

    <a href="https://wa.me/491633845081" target="_blank" rel="noopener noreferrer" onclick="window.trackEvent && window.trackEvent('contact_click', { channel: 'whatsapp', location: 'mobile_bar' })" class="flex items-center gap-2 bg-[#128C7E] text-white px-6 py-2.5 rounded-full font-bold shadow-[0_0_15px_rgba(18,140,126,0.3)] hover:bg-[#0f7c6e] transition-all active:scale-95 -translate-y-4 border border-white/10">
        <MessageCircle size={20} fill="currentColor" />
        <span>WhatsApp</span>
    </a>

    <a href="/#rechner" onclick="window.trackEvent && window.trackEvent('element_view', { element: 'calculator', location: 'mobile_bar' })" class="flex flex-col items-center gap-1 text-zinc-400 hover:text-white transition-colors active:scale-95 w-16">
        <Calculator size={22} strokeWidth={1.5} />
        <span class="text-[9px] font-bold uppercase tracking-wider">Preis</span>
    </a>
</div>

<style>
    /* Ensure content isn't hidden behind the bar */
    :global(body) {
        padding-bottom: 80px; /* Adjust based on bar height */
    }
    @media (min-width: 768px) {
        :global(body) {
            padding-bottom: 0;
        }
    }

    /* Hide bar when mobile menu is open (body has overflow-hidden) */
    :global(body.overflow-hidden) #mobile-sticky-bar {
        transform: translateY(150%) !important;
    }
</style>

<script>
    const stickyBar = document.getElementById('mobile-sticky-bar');

    // BOLT OPTIMIZATION:
    // Replaced scroll event listener with IntersectionObserver to improve main thread performance.
    // Instead of checking scroll position on every frame, we observe a sentinel element.
    const sentinel = document.createElement('div');
    sentinel.style.position = 'absolute';
    sentinel.style.top = '0';
    sentinel.style.left = '0';
    sentinel.style.width = '1px';
    sentinel.style.height = '500px'; // Threshold for showing the bar
    sentinel.style.pointerEvents = 'none';
    sentinel.style.visibility = 'hidden';
    document.body.appendChild(sentinel);

    const observer = new IntersectionObserver((entries) => {
        const entry = entries[0];
        if (!stickyBar) return;

        // Show bar when we've scrolled past the sentinel (it's no longer intersecting and above viewport)
        // If entry.boundingClientRect.top < 0, it means we are below the sentinel (scrolled down).
        if (!entry.isIntersecting && entry.boundingClientRect.top < 0) {
            stickyBar.classList.remove('translate-y-[150%]');
            stickyBar.removeAttribute('inert');
            stickyBar.removeAttribute('aria-hidden');
        } else {
            // Hide bar when we are within the first 500px (intersecting or above)
            stickyBar.classList.add('translate-y-[150%]');
            stickyBar.setAttribute('inert', '');
            stickyBar.setAttribute('aria-hidden', 'true');
        }
    });

    observer.observe(sentinel);
</script>
